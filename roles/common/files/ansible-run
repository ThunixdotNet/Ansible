#!/bin/bash
export RUNNING="/dev/shm/ansible_is_running"
export HOOK="/dev/shm/ansible-hook-last-run"
export SCHED="/dev/shm/ansible_scheduler"

ansible_is_running()
{
	touch $RUNNING
	cd /var/thunix/ansible
	/usr/bin/git pull
	/usr/local/bin/ansible-playbook -i /var/thunix/ansible/hosts /var/thunix/ansible/site.yml -u root
	rm $RUNNING
}

# sets ansible scheduling
touch $SCHED

if [ -f $RUNNING ]; then
   echo "Ansible is currently running."
else
	while [ -f $SCHED ]
	do
		rm $SCHED
		ansible_is_running
		touch $HOOK
	done
fi
