#!/bin/bash
export RUNNING="/dev/shm/ansible_is_running"
export HOOK="/dev/shm/ansible-hook-last-run"
export SCHED="/dev/shm/ansible_scheduler"

# sets ansible scheduling
touch $SCHED

if [ -f $RUNNING ]; then
   echo "Ansible is currently running."
else
	cd /var/thunix/ansible
	while [ -f $SCHED ]
	do
		rm $SCHED
		touch $RUNNING
		/usr/bin/git pull
		/usr/local/bin/ansible-playbook -i /var/thunix/ansible/hosts /var/thunix/ansible/site.yml -u root
		touch $HOOK
	done
	rm $RUNNING
fi
