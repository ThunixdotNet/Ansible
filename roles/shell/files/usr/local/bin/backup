#!/bin/bash

DATE=$(date +%Y%m%d)
PATH='/var/backups'

tar -cz \
 --exclude ".nobackup" \
 --exclude "nobackup" \
 --exclude "/home/irc/*" \
 --exclude='/home/chuck/*' \
 --exclude='/home/slip/*' \
 --exclude='/home/angelok/*' \
 --exclude='/home/usernameak/*' \
 --exclude='/home/ubergeek/*' \
 --exclude='/home/amcclure/*' \
 --exclude='/home/fosslinux/*' \
 --exclude='/home/zszoke/*' \
 /home/ \
 /var/games/minetest-server/.minetest/ \
 /var/lib/minecraft/paperclip/ \
 /var/lib/bzflag/ \
 /var/spool/cron/ \
 /var/spool/anacron/ \
 -f $PATH/$DATE.tgz

mysqldump --all-databases > $PATH/$DATE-all_databases.sql
tar --remove-files -cz $PATH/$DATE-all_databases.sql \
 -f $PATH/$DATE-all_databases.sql.tgz

chown root:sudo $PATH/$DATE*.tgz
chmod 640 $PATH/*.tgz

find $PATH -name "*.tgz" -mtime +3 -exec rm {} \;
rm $PATH/all_databases.sql
